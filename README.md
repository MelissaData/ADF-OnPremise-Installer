# Data Quality Components for SSIS on Azure Data Factory

This project provides a custom setup script and installation files to deploy .NET Framework 3.5 and Melissa SSIS components onto an **Azure Data Factory (ADF) Integration Runtime (SSIS-IR)**. Once deployed, you can create an SSIS package locally in your development environment, then deploy that package to Azure SQL Server (SSISDB) and execute it using an SSIS Integration Runtime (SSIS-IR) instance in Azure Data Factory. This approach allows you to scale SSIS package processing in the cloud, providing greater flexibility, reliability, and resource management compared to traditional on-premises deployments.

**This Git is for Melissa's On-Premise SSIS Components:**
- Contact Verify – On-Premise version
- Fuzzy Matching
- Generalized Cleanser
- MatchUp
- Profiler

---

## Getting Started

Follow these steps to set up an SSIS Integration Runtime (SSIS-IR) in Azure Data Factory, configured to run Melissa SSIS components using your own Azure Blob Storage container.

---

## Step-by-Step Instructions

## Part 1: Prepare the Data Files for the On-Premise Components

### Step 1: Ensure That an Azure File Share Instance Is Set Up to Store Data Files Required by Melissa’s Components

This is Azure’s cloud storage solution, which will be accessible both from your local machine and the SSIS-IR instances within Azure Data Factory. It will serve as the central location for storing all data files required by the SSIS components.

Follow Microsoft’s instructions here to create and configure an Azure File Share: https://learn.microsoft.com/en-us/azure/storage/files/storage-how-to-use-files-portal?tabs=azure-portal

The Azure File Share should appear within your Azure Storage Account.

---

### Step 2: Connect the Azure File Share to Your Local Machine to Deploy Data Files Onto It

Click the three dots `[...]` next to the Azure File Share you want to use for deploying data files, then select **Connect** from the dropdown menu.

To generate a PowerShell script that connects your local machine to the Azure File Share:

1. **Select the "Windows" tab** (at the top).
2. **Choose a Drive Letter** (e.g., Z).
3. **Select "Storage account key"** as the authentication method.
4. Click the **"Show Script"** button.

This will generate a ready-to-use PowerShell script you can run from a **normal (non-elevated) PowerShell terminal** to mount the file share on your local machine.

Run the script using PowerShell on your local machine. This script checks connectivity via port 445, saves the credentials, and mounts the file share as a network drive.

**To verify the connection was successful, open File Explorer and navigate to the path generated by your script. It should look something like:**
`\\melissadatafileshare.file.core.windows.net\ssis-data-files`

---

### Step 3: Set Up Directories to Store Data Files

1. **Open File Explorer** and navigate to the local path of your Azure File Share.

   **Example:**  
   `\\melissadatafileshare.file.core.windows.net\ssis-data-files`

2. **Determine which Melissa components you plan to use.**

   You only need to set up folders for the components you intend to deploy.

3. **Manually create the following folders** under the root of your Azure File Share.

   These folders can remain empty for now:

   - **Contact Verify** → `object-data-files`  
   - **Profiler** → `object-data-files`  
   - **Generalized Cleanser** → `object-data-files`  
   - **Matchup** → `matchup-data-files`

   > **Important:** Folder names must match exactly as shown above.  
   > The SSIS-IR deployment setup script relies on these precise folder names to deploy successfully.

**Example:**  
Contact Verify directory:  
`\\melissadatafileshare.file.core.windows.net\ssis-data-files\object-data-files`

---

### Step 4: Upload Data Files to the Azure File Share

1. **Download the Melissa Updater.**

   Download `MelissaUpdater.exe` using the following link:
   https://releases.melissadata.net/Download/Library/WINDOWS/NET/ANY/latest/MelissaUpdater.exe

2. **Run Melissa Updater in PowerShell.**

   Use the following command syntax in PowerShell:
   ```powershell
   .\MelissaUpdater.exe manifest `
      -p "{{ProductName}}" `
      -r "latest" `
      -l "{{LicenseKey}}" `
      -t "{{Path}}"
   ```

3. **Replace the placeholders with your values:.**

   - **ProductName**

     - *For Contact Verify*, there are **five** products, so you will need to run the command five times—once for each:

       - `dq_addr_data`  
       - `dq_email_data`  
       - `geocoder_data`  
       - `dq_name_data`  
       - `dq_phone_data`

     - *For Profiler:* `profiler_data`

     - *For Cleanser:* `cleanser_data`

     - *For Match Up:* `global_mu_data`

   - **LicenseKey**  
     Your SSIS license key. If you don’t have one, please contact your Melissa sales representative.

   - **Path**  
     The destination path where the data files should be downloaded.  
     Typically, this is your Azure File Share directory, e.g.:

     `\\melissadatafileshare.file.core.windows.net\ssis-data-files\object-data-files`

     > Alternatively, you can download to a local folder and manually move the files to **Azure File Share**.

> **Tip:**  
> Contact Verify data files are updated monthly. You can reuse this same method to keep your data files *up to date*.

---

### Step 5: Verify All Data Files Are in Place

Review your data file directories to ensure everything is correctly structured. A properly organized layout should look like this:

```
Azure File Share Root
├── object-data-files/
│   └── Contains data files for Contact Verify, Profiler, and Generalized Cleanser (if applicable)
└── matchup-data-files/
    └── Contains data files for Match Up (if applicable)
```

If everything looks correct, **you're all set** to proceed to Part 2!

---

## Part 2: Set Up the Azure Data Factory Environment by Starting an SSIS Integration Runtime (SSIS-IR) Instance
Follow these steps to set up an SSIS Integration Runtime (SSIS-IR) in Azure Data Factory, configured to run Melissa SSIS components using your own Azure Blob Storage container.

---

### Step 1: Clone the ADF On-Premise Installer Repository

Clone the ADF On-Premise Installer repository to your local machine using this Git repository:

```powershell
git clone https://github.com/MelissaData/ADF-OnPremise-Installer
```

---

### Step 2: Download Installation Dependencies
You have two options to obtain the installation dependencies required for setting up the SSIS-IR.

#### Option 1: Using a Download Link:

Download the pre-packaged `DependenciesADF.zip` from the following link:
https://releases.melissadata.net/Download/Interface/WINDOWS/ADF/ANY/latest/DependenciesADF.zip/?ID={{LicenseKey}}

⇒ After downloading, extract the contents into the same directory as your cloned repository.

#### Option 2: Using Melissa Updater:

Download Melissa Updater:  
   - **Windows:**  
     https://releases.melissadata.net/Download/Library/WINDOWS/NET/ANY/latest/MelissaUpdater.exe  
   - **Linux:**  
     https://releases.melissadata.net/Download/Library/LINUX/NET/ANY/latest/MelissaUpdater

Run Melissa Updater from the command line:

```powershell
.\MelissaUpdater.exe file `
    -n "DependenciesADF.zip" `
    -r "latest" `
    -l "{{LicenseKey}}" `
    -y "INTERFACE" -o "WINDOWS" -c "ADF" -a "ANY" `
    -t "{{DownloadDirectory}}"
```
⇒ After downloading, extract the contents into the same directory as your cloned repository.

#### Directory Structure After Extraction
The extracted folder should contain the following:

```
.
├── Setup.ps1
├── main.cmd
├── dotnet-framework-35/
│   └── microsoft-windows-netfx3-ondemand-package~31bf3856ad364e35~amd64~~.cab
└── melissa-web-installer/
    └── ADF-DQC-Web.exe
```

---

### Step 3: Create an Azure Blob Storage Container

1. Open your **Azure Storage Account**.
2. Create a **new container** (e.g., `ssis-ir-deployment`).
3. Generate a **SAS Token** with **Read, Add, Create, Write, Delete, and List** permissions for the container.
   - Be sure to **copy the full SAS string**.

   > **Note:** We recommend setting a long expiration date for the SAS token. Azure Data Factory may re-deploy the SSIS-IR at a later time using this token.

---

### Step 4: Configure the Setup Script

Open `Setup.ps1` in a code editor and update the following variables:

```powershell
# Blob Storage Information
$storageAccount  = "<your_storage_account_name>"
$containerName   = "<your_container_name>"

# SAS Token (add the leading '?')
$sasToken        = "<your_blob_container_SAS>" # This should look like "?sp=...&sig=..."

# Melissa Product License Key
$productLicense  = "<your_license_key>"
```

Save the file after making your changes.

---

### Step 5: Upload Deployment Files to Blob

Upload **all files and folders in this repository** to the container you just created.

**Important:**  
Do **not** place files inside an additional folder.  
The SSIS-IR setup process expects `main.cmd` to be at the **top level** of the container.

---

### Step 6: Configure SSIS-IR in Azure Data Factory

1. Navigate to **Azure Data Factory > Integration Runtimes**.
2. Click **+ New** to create a new **Azure-SSIS Integration Runtime**.
3. During setup, under **Integration runtime setup**, be sure to:
   - Check the box:  
     **"Customize your Azure-SSIS Integration Runtime with additional system configurations/component installations"**
   - Provide the full **SAS URL** to your blob container:
     ```
     https://<your_storage_account>.blob.core.windows.net/<your_container_name>?<your_sas_token>
     ```

This allows ADF to run your custom startup script and install Melissa SSIS components automatically during IR provisioning.

---

### Step 7: Start the SSIS-IR

On startup, the SSIS-IR will:
- Install prerequisites (.NET Framework 3.5)
- Install Melissa SSIS components

---

## Logs & Troubleshooting

You can monitor logs from the setup process directly in your blob container:

| Folder Name           | Description                               |
|-----------------------|-------------------------------------------|
| `custom-setup-logs/`  | Logs from the custom setup script         |
| `installer-logs/`     | Logs from the Melissa installer           |

If the IR fails to start or install, check the latest files in those folders for detailed error messages.

---

## Tips

- You can restart the SSIS-IR to re-trigger the setup.
- Make sure you **do not rename** or move files from the repository before uploading.

---

## Contact Us

For free technical support, please call us at 800-MELISSA ext. 4 (800-635-4772 ext. 4) or email us at Tech@Melissa.com.

To purchase this product, contact the Melissa sales department at 800-MELISSA ext. 3 (800-635-4772 ext. 3).
